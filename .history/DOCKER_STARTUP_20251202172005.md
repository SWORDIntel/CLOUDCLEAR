# CloudClear Docker Startup Guide

## Random Port Assignment & Optional Caddy

CloudClear automatically assigns random available ports on startup to avoid port conflicts. **Caddy reverse proxy is optional** - you can run with or without it.

## Quick Start

### Start CloudClear with Caddy (Default - Recommended)

```bash
./docker-start.sh
```

Or explicitly enable Caddy:

```bash
USE_CADDY=1 ./docker-start.sh
```

This will:
1. Find random available ports (HTTP and HTTPS for Caddy)
2. Start API and Caddy containers
3. Display the assigned ports clearly
4. Save ports to `.docker-ports` file for reference
5. Provide web UI access through Caddy

### Start CloudClear without Caddy (Direct API Access)

```bash
USE_CADDY=0 ./docker-start.sh
```

This will:
1. Find random available port for direct API access
2. Start only the API container (no Caddy)
3. Display the direct API port
4. **Note:** Web UI will not be available without Caddy

### View Current Ports

If you forget the assigned ports, run:

```bash
./docker-ports.sh
```

This displays:

- Current HTTP port
- Current HTTPS port
- Quick access links
- Saved ports from startup

## Example Output

### With Caddy Enabled (Default)

When you run `./docker-start.sh`, you'll see:

```
Mode: Caddy Reverse Proxy Enabled

╔════════════════════════════════════════════════════════════╗
║                    ACCESS INFORMATION                      ║
╚════════════════════════════════════════════════════════════╝

Web Interface (HTTP):
  http://localhost:8143

Web Interface (HTTPS):
  https://localhost:9778

API Health Check (via Caddy):
  http://localhost:8143/health

API Endpoint (via Caddy):
  http://localhost:8143/api/
```

### Without Caddy (Direct API)

When you run `USE_CADDY=0 ./docker-start.sh`, you'll see:

```
Mode: Direct API Access (Caddy Disabled)

╔════════════════════════════════════════════════════════════╗
║                    ACCESS INFORMATION                      ║
╚════════════════════════════════════════════════════════════╝

API Direct Access:
  http://localhost:8118

API Health Check:
  http://localhost:8118/health

API Endpoint:
  http://localhost:8118/api/

Note: Caddy reverse proxy is disabled. Web UI not available.
      Enable with: USE_CADDY=1 ./docker-start.sh
```

## Manual Port Assignment

### With Caddy

If you want to use specific ports instead of random ones:

```bash
export CADDY_HTTP_PORT=8080
export CADDY_HTTPS_PORT=8443
USE_CADDY=1 ./docker-start.sh
```

### Direct API Access

For direct API access with a specific port:

```bash
export API_DIRECT_PORT=5000
USE_CADDY=0 ./docker-start.sh
```

Or use docker-compose directly:

```bash
export API_DIRECT_PORT=5000
docker-compose up -d cloudclear-api
```

## Useful Commands

```bash
# View logs
docker-compose logs -f

# Stop containers
docker-compose down

# Restart containers
docker-compose restart

# View container status
docker-compose ps

# View ports
./docker-ports.sh
```

## Port Range

- HTTP ports are randomly selected from range: 8000-9000
- HTTPS ports are randomly selected from range: 9000-10000

Ports are automatically checked for availability before assignment.
