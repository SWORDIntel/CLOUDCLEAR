# CloudUnflare Enhanced v2.0 - Fluent Bit Log Configuration
# Optimized for CloudUnflare log aggregation and analysis

[SERVICE]
    Flush         5
    Daemon        off
    Log_Level     info
    Parsers_File  parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020

# CloudUnflare Main Application Logs
[INPUT]
    Name              tail
    Path              /fluent-bit/log/cloudunflare-*.log
    Parser            cloudunflare_parser
    Tag               cloudunflare.main
    Refresh_Interval  5
    Skip_Long_Lines   On
    Skip_Empty_Lines  On

# CloudUnflare Reconnaissance Logs
[INPUT]
    Name              tail
    Path              /fluent-bit/log/recon-*.log
    Parser            cloudunflare_recon_parser
    Tag               cloudunflare.recon
    Refresh_Interval  5
    Skip_Long_Lines   On
    Skip_Empty_Lines  On

# CloudUnflare Performance Metrics
[INPUT]
    Name              tail
    Path              /fluent-bit/log/performance-*.log
    Parser            json
    Tag               cloudunflare.metrics
    Refresh_Interval  10

# CloudUnflare Security Events
[INPUT]
    Name              tail
    Path              /fluent-bit/log/security-*.log
    Parser            cloudunflare_security_parser
    Tag               cloudunflare.security
    Refresh_Interval  2

# DNS Query Logs
[INPUT]
    Name              tail
    Path              /fluent-bit/log/dns-*.log
    Parser            dns_query_parser
    Tag               cloudunflare.dns
    Refresh_Interval  5

# Filter for CloudUnflare Main Logs
[FILTER]
    Name          parser
    Match         cloudunflare.main
    Key_Name      message
    Parser        cloudunflare_main_detailed
    Reserve_Data  On

# Filter for Reconnaissance Logs
[FILTER]
    Name          parser
    Match         cloudunflare.recon
    Key_Name      message
    Parser        recon_detailed
    Reserve_Data  On

# Filter for Security Events (high priority)
[FILTER]
    Name          modify
    Match         cloudunflare.security
    Add           priority high
    Add           alert_type security_event

# Filter for Performance Metrics
[FILTER]
    Name          modify
    Match         cloudunflare.metrics
    Add           source cloudunflare
    Add           metric_type performance

# Filter to add Kubernetes-style metadata
[FILTER]
    Name          modify
    Match         cloudunflare.*
    Add           cluster cloudunflare-cluster
    Add           namespace cloudunflare
    Add           application cloudunflare-enhanced

# Output to stdout for development
[OUTPUT]
    Name   stdout
    Match  cloudunflare.*
    Format json_lines

# Output security events to separate file
[OUTPUT]
    Name  file
    Match cloudunflare.security
    Path  /fluent-bit/log/processed/
    File  security-events.log
    Format json_lines

# Output performance metrics
[OUTPUT]
    Name  file
    Match cloudunflare.metrics
    Path  /fluent-bit/log/processed/
    File  performance-metrics.log
    Format json_lines

# Forward to external log aggregation (if configured)
# [OUTPUT]
#     Name        forward
#     Match       cloudunflare.*
#     Host        your-log-server.com
#     Port        24224
#     Require_ack_response true

# HTTP output for webhook integration
# [OUTPUT]
#     Name        http
#     Match       cloudunflare.security
#     Host        your-webhook-endpoint.com
#     Port        443
#     URI         /cloudunflare/security-alerts
#     Format      json
#     tls         on
#     tls.verify  on